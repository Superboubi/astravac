(()=>{var e={};e.id=352,e.ids=[352],e.modules={7849:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external")},2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},5403:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},4749:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},4300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},9820:e=>{"use strict";e.exports=require("events")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},1808:e=>{"use strict";e.exports=require("net")},5477:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},4404:e=>{"use strict";e.exports=require("tls")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},7168:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>l.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>c,routeModule:()=>x,tree:()=>o});var r=t(482),a=t(9108),i=t(2563),l=t.n(i),n=t(8300),d={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>n[e]);t.d(s,d);let o=["",{children:["admin",{children:["storage",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,2726)),"/Users/saill/Desktop/Premium cursor Astra/src/app/admin/storage/page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,1342)),"/Users/saill/Desktop/Premium cursor Astra/src/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,9361,23)),"next/dist/client/components/not-found-error"]}],c=["/Users/saill/Desktop/Premium cursor Astra/src/app/admin/storage/page.tsx"],m="/admin/storage/page",u={require:t,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/admin/storage/page",pathname:"/admin/storage",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},6407:(e,s,t)=>{Promise.resolve().then(t.t.bind(t,2583,23)),Promise.resolve().then(t.t.bind(t,6840,23)),Promise.resolve().then(t.t.bind(t,8771,23)),Promise.resolve().then(t.t.bind(t,3225,23)),Promise.resolve().then(t.t.bind(t,9295,23)),Promise.resolve().then(t.t.bind(t,3982,23))},8586:(e,s,t)=>{Promise.resolve().then(t.bind(t,2472))},5826:()=>{},2472:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>d});var r=t(5344),a=t(8428),i=t(3729),l=t(9835),n=t(7430);function d(){let e=(0,a.useRouter)(),[s,t]=(0,i.useState)({totalSpace:1e3,usedSpace:0,totalUsers:0,totalFolders:0,totalPhotos:0,spaceByUser:[]}),[d,o]=(0,i.useState)(!0),[c,m]=(0,i.useState)(null);(0,i.useEffect)(()=>{(async()=>{let{data:{session:s}}=await n.O.auth.getSession();if(!s){e.push("/auth/login");return}let{data:t,error:r}=await n.O.from("users").select("role").eq("id",s.user.id).single();if(r||t?.role!=="admin"){e.push("/dashboard");return}u()})()},[e]);let u=async()=>{try{o(!0),m(null);let{data:e,error:s}=await n.O.from("users").select("*");if(s)throw s;let{data:r,error:a}=await n.O.from("photos").select("*");if(a)throw a;let i=e.map(e=>{let s=r.filter(s=>s.user_id===e.id),t=s.reduce((e,s)=>e+(s.size||0),0)/1073741824;return{userId:e.id,userName:e.name,usedSpace:t,photoCount:s.length}}),l=i.reduce((e,s)=>e+s.usedSpace,0),d=r.length;t({totalSpace:1e3,usedSpace:l,totalUsers:e.length,totalFolders:e.reduce((e,s)=>e+s.folders?.length||0,0),totalPhotos:d,spaceByUser:i})}catch(e){console.error("Erreur lors du chargement des statistiques:",e),m("Erreur lors du chargement des statistiques")}finally{o(!1)}},x=e=>e>=1e3?`${(e/1e3).toFixed(1)} TB`:`${e.toFixed(1)} GB`,h=(e,s)=>(e/s*100).toFixed(1);return d?(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[r.jsx(l.N,{}),r.jsx("div",{className:"flex items-center justify-center min-h-[calc(100vh-64px)]",children:r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})})]}):c?(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[r.jsx(l.N,{}),r.jsx("div",{className:"flex items-center justify-center min-h-[calc(100vh-64px)]",children:r.jsx("div",{className:"text-red-500",children:c})})]}):(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[r.jsx(l.N,{}),(0,r.jsxs)("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:[r.jsx("div",{className:"py-6",children:r.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Gestion du stockage"})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4",children:[(0,r.jsxs)("div",{className:"overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6",children:[r.jsx("dt",{className:"truncate text-sm font-medium text-gray-500",children:"Espace total"}),r.jsx("dd",{className:"mt-1 text-3xl font-semibold tracking-tight text-gray-900",children:x(s.totalSpace)})]}),(0,r.jsxs)("div",{className:"overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6",children:[r.jsx("dt",{className:"truncate text-sm font-medium text-gray-500",children:"Espace utilis\xe9"}),r.jsx("dd",{className:"mt-1 text-3xl font-semibold tracking-tight text-gray-900",children:x(s.usedSpace)})]}),(0,r.jsxs)("div",{className:"overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6",children:[r.jsx("dt",{className:"truncate text-sm font-medium text-gray-500",children:"Utilisateurs"}),r.jsx("dd",{className:"mt-1 text-3xl font-semibold tracking-tight text-gray-900",children:s.totalUsers})]}),(0,r.jsxs)("div",{className:"overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6",children:[r.jsx("dt",{className:"truncate text-sm font-medium text-gray-500",children:"Photos totales"}),r.jsx("dd",{className:"mt-1 text-3xl font-semibold tracking-tight text-gray-900",children:s.totalPhotos})]})]}),r.jsx("div",{className:"mt-8",children:r.jsx("div",{className:"overflow-hidden rounded-lg bg-white shadow",children:(0,r.jsxs)("div",{className:"px-4 py-5 sm:p-6",children:[r.jsx("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:"Utilisation par utilisateur"}),r.jsx("div",{className:"mt-4",children:r.jsx("div",{className:"relative pt-1",children:r.jsx("div",{className:"overflow-hidden h-2 mb-4 text-xs flex rounded bg-blue-200",children:r.jsx("div",{style:{width:`${h(s.usedSpace,s.totalSpace)}%`},className:"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-blue-500"})})})}),r.jsx("div",{className:"mt-4",children:r.jsx("ul",{className:"divide-y divide-gray-200",children:s.spaceByUser.map(e=>(0,r.jsxs)("li",{className:"py-5",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[r.jsx("p",{className:"text-sm font-medium text-gray-900",children:e.userName}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:[e.photoCount," photos â€¢ ",x(e.usedSpace)]})]}),(0,r.jsxs)("div",{className:"text-sm text-gray-500",children:[h(e.usedSpace,s.totalSpace),"%"]})]}),r.jsx("div",{className:"mt-4",children:r.jsx("div",{className:"relative pt-1",children:r.jsx("div",{className:"overflow-hidden h-2 mb-4 text-xs flex rounded bg-blue-200",children:r.jsx("div",{style:{width:`${h(e.usedSpace,s.totalSpace)}%`},className:"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-blue-500"})})})})]},e.userId))})})]})})})]})]})}},9835:(e,s,t)=>{"use strict";t.d(s,{N:()=>l});var r=t(5344),a=t(8428),i=t(6506);function l(){let e=(0,a.useRouter)();return r.jsx("nav",{className:"bg-white shadow",children:r.jsx("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex h-16 justify-between",children:[(0,r.jsxs)("div",{className:"flex",children:[r.jsx("div",{className:"flex flex-shrink-0 items-center",children:r.jsx("span",{className:"text-xl font-bold text-blue-600",children:"Admin Panel"})}),(0,r.jsxs)("div",{className:"hidden sm:ml-6 sm:flex sm:space-x-8",children:[r.jsx(i.default,{href:"/admin/dashboard",className:"inline-flex items-center border-b-2 border-blue-500 px-1 pt-1 text-sm font-medium text-gray-900",children:"Tableau de bord"}),r.jsx(i.default,{href:"/admin/users",className:"inline-flex items-center border-b-2 border-transparent px-1 pt-1 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-gray-700",children:"Utilisateurs"})]})]}),r.jsx("div",{className:"flex items-center",children:r.jsx("button",{onClick:()=>{localStorage.removeItem("isAuthenticated"),localStorage.removeItem("userRole"),localStorage.removeItem("userName"),e.push("/auth/login")},className:"rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-600",children:"D\xe9connexion"})})]})})})}},7430:(e,s,t)=>{"use strict";t.d(s,{O:()=>i});var r=t(3125);let a={supabase:{url:"https://igeaimikswzxnaduekrr.supabase.co",anonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlnZWFpbWlrc3d6eG5hZHVla3JyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI4OTQ2OTMsImV4cCI6MjA1ODQ3MDY5M30.S3osZcB9x8ygSDDMOfTxvvUHoxAbL1zlQNY70uLVrJA"}},i=(0,r.eI)(a.supabase.url,a.supabase.anonKey)},2726:(e,s,t)=>{"use strict";t.r(s),t.d(s,{$$typeof:()=>i,__esModule:()=>a,default:()=>l});let r=(0,t(6843).createProxy)(String.raw`/Users/saill/Desktop/Premium cursor Astra/src/app/admin/storage/page.tsx`),{__esModule:a,$$typeof:i}=r,l=r.default},1342:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>n,metadata:()=>l});var r=t(5036),a=t(2195),i=t.n(a);t(5023);let l={title:"Photo Gallery App",description:"Une application moderne pour g\xe9rer vos photos"};function n({children:e}){return r.jsx("html",{lang:"fr",children:r.jsx("body",{className:i().className,children:r.jsx("main",{className:"min-h-screen bg-gray-50",children:e})})})}},5023:()=>{}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[479,476,833],()=>t(7168));module.exports=r})();