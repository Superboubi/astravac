(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[702],{8621:function(e,r,t){Promise.resolve().then(t.bind(t,8673))},8673:function(e,r,t){"use strict";t.r(r),t.d(r,{default:function(){return c}});var s=t(3827),a=t(7907),o=t(4090),l=t(8792),i=t(7662);function n(){let e=(0,a.usePathname)(),[r,t]=(0,o.useState)(null),[n,d]=(0,o.useState)(!1),[c,u]=(0,o.useState)(!1);(0,o.useEffect)(()=>{(async()=>{let{data:{session:e}}=await i.O.auth.getSession();if(!e)return;let{data:r,error:s}=await i.O.from("users").select("name, role").eq("id",e.user.id).single();if(s){console.error("Erreur lors de la r\xe9cup\xe9ration des donn\xe9es utilisateur:",s);return}t(r.name),u("admin"===r.role)})()},[]);let h=async()=>{try{let{error:e}=await i.O.auth.signOut();if(e)throw e;localStorage.removeItem("isAuthenticated"),localStorage.removeItem("userRole"),localStorage.removeItem("userName"),window.location.href="/auth/login"}catch(e){console.error("Erreur lors de la d\xe9connexion:",e),alert("Erreur lors de la d\xe9connexion")}};return(0,s.jsxs)("nav",{className:"bg-white shadow-md",children:[(0,s.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"flex justify-between h-16",children:[(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("div",{className:"flex-shrink-0 flex items-center",children:(0,s.jsx)(l.default,{href:"/",className:"text-xl font-bold text-blue-600",children:"PhotoApp"})}),(0,s.jsxs)("div",{className:"hidden sm:ml-6 sm:flex sm:space-x-8",children:[(0,s.jsx)(l.default,{href:"/dashboard",className:"inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium ".concat("/dashboard"===e?"border-blue-500 text-gray-900":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700"),children:"Tableau de bord"}),c&&(0,s.jsx)(l.default,{href:"/admin",className:"inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium ".concat("/admin"===e?"border-blue-500 text-gray-900":"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700"),children:"Administration"})]})]}),(0,s.jsx)("div",{className:"hidden sm:ml-6 sm:flex sm:items-center",children:(0,s.jsx)("div",{className:"ml-3 relative",children:(0,s.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,s.jsx)("span",{className:"text-gray-700",children:r}),(0,s.jsx)("button",{onClick:h,className:"bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors",children:"D\xe9connexion"})]})})}),(0,s.jsx)("div",{className:"flex items-center sm:hidden",children:(0,s.jsxs)("button",{onClick:()=>d(!n),className:"inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-inset focus:ring-blue-500",children:[(0,s.jsx)("span",{className:"sr-only",children:"Ouvrir le menu"}),n?(0,s.jsx)("svg",{className:"block h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})}):(0,s.jsx)("svg",{className:"block h-6 w-6",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 12h16M4 18h16"})})]})})]})}),n&&(0,s.jsx)("div",{className:"sm:hidden",children:(0,s.jsxs)("div",{className:"pt-2 pb-3 space-y-1",children:[(0,s.jsx)(l.default,{href:"/dashboard",className:"block pl-3 pr-4 py-2 border-l-4 text-base font-medium ".concat("/dashboard"===e?"bg-blue-50 border-blue-500 text-blue-700":"border-transparent text-gray-500 hover:bg-gray-50 hover:border-gray-300 hover:text-gray-700"),children:"Tableau de bord"}),c&&(0,s.jsx)(l.default,{href:"/admin",className:"block pl-3 pr-4 py-2 border-l-4 text-base font-medium ".concat("/admin"===e?"bg-blue-50 border-blue-500 text-blue-700":"border-transparent text-gray-500 hover:bg-gray-50 hover:border-gray-300 hover:text-gray-700"),children:"Administration"}),(0,s.jsxs)("div",{className:"pl-3 pr-4 py-2",children:[(0,s.jsx)("span",{className:"block text-gray-700",children:r}),(0,s.jsx)("button",{onClick:h,className:"mt-2 w-full bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors",children:"D\xe9connexion"})]})]})})]})}function d(e){let{url:r,name:t,uploaded_at:a,onDelete:l}=e,[i,n]=(0,o.useState)(!1),[d,c]=(0,o.useState)(!0);return(0,o.useEffect)(()=>{let e=e=>{"Escape"===e.key&&n(!1)};return i&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow="unset"}},[i]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"bg-white rounded-lg shadow-md overflow-hidden cursor-pointer hover:shadow-lg transition-shadow",onClick:()=>n(!0),children:[(0,s.jsxs)("div",{className:"relative aspect-square group",children:[(0,s.jsx)("img",{src:r,alt:t,className:"w-full h-full object-cover",onLoad:()=>c(!1)}),d&&(0,s.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-gray-100",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}),(0,s.jsx)("div",{className:"absolute inset-0 bg-black bg-opacity-0 group-hover:bg-opacity-40 transition-opacity flex items-center justify-center",children:(0,s.jsx)("span",{className:"text-white opacity-0 group-hover:opacity-100 transition-opacity",children:"Cliquez pour agrandir"})}),(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),l()},className:"absolute top-2 right-2 bg-red-500 text-white p-2 rounded-full hover:bg-red-600 transition-colors opacity-0 group-hover:opacity-100",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]}),(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsx)("h3",{className:"font-medium truncate",children:t}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:new Date(a).toLocaleDateString()})]})]}),i&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-75 z-50 flex items-center justify-center p-4",onClick:()=>n(!1),children:(0,s.jsxs)("div",{className:"relative max-w-4xl w-full",children:[(0,s.jsx)("button",{onClick:()=>n(!1),className:"absolute -top-12 right-0 text-white hover:text-gray-300 transition-colors",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-8 w-8",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("img",{src:r,alt:t,className:"w-full h-auto rounded-lg",style:{maxHeight:"80vh"}}),(0,s.jsxs)("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent p-4 rounded-b-lg",children:[(0,s.jsx)("h3",{className:"text-xl font-semibold text-white",children:t}),(0,s.jsxs)("p",{className:"text-sm text-gray-300",children:["Ajout\xe9e le ",new Date(a).toLocaleDateString()]})]})]})]})})]})}function c(){var e,r;let t=(0,a.useRouter)(),[l,c]=(0,o.useState)([]),[u,h]=(0,o.useState)(!0),[m,p]=(0,o.useState)(null),[x,g]=(0,o.useState)(null),[f,b]=(0,o.useState)(!1);(0,o.useEffect)(()=>{(async()=>{let{data:{session:e}}=await i.O.auth.getSession();if(!e){t.push("/auth/login");return}v(e.user.id)})()},[t]);let v=async e=>{try{let{data:r,error:t}=await i.O.from("folders").select("*").eq("user_id",e).order("created_at",{ascending:!1});if(t)throw t;let{data:s,error:a}=await i.O.from("photos").select("*").eq("user_id",e).order("uploaded_at",{ascending:!1});if(a)throw a;let o=r.filter(r=>r.user_id===e).map(r=>({...r,photoCount:s.filter(t=>t.folder_id===r.id&&t.user_id===e).length,lastModified:new Date(r.updated_at).toLocaleDateString(),photos:s.filter(t=>t.folder_id===r.id&&t.user_id===e).map(e=>({...e,uploaded_at:new Date(e.uploaded_at).toLocaleDateString()}))}));c(o)}catch(e){console.error("Erreur lors du chargement des dossiers:",e),p("Erreur lors du chargement des dossiers")}finally{h(!1)}},w=async()=>{let{data:{session:e}}=await i.O.auth.getSession();if(!e)return;let r=prompt("Nom du nouveau dossier:");if(r)try{let{data:t,error:s}=await i.O.from("folders").insert([{name:r,user_id:e.user.id}]).select().single();if(s)throw s;c(e=>[{...t,photoCount:0,lastModified:new Date(t.created_at).toLocaleDateString(),photos:[]},...e])}catch(e){console.error("Erreur lors de la cr\xe9ation du dossier:",e),p("Erreur lors de la cr\xe9ation du dossier")}},j=(0,o.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),b(!0)},[]),y=(0,o.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),b(!1)},[]),N=(0,o.useCallback)(e=>{e.preventDefault(),e.stopPropagation()},[]),k=(0,o.useCallback)(async e=>{if(e.preventDefault(),e.stopPropagation(),b(!1),!x){alert("Veuillez s\xe9lectionner un dossier avant de d\xe9poser des photos");return}let r=Array.from(e.dataTransfer.files).filter(e=>e.type.startsWith("image/"));if(0===r.length){alert("Veuillez d\xe9poser uniquement des fichiers images");return}try{let{data:{session:e}}=await i.O.auth.getSession();if(!e)return;for(let t of r){if(t.size>10485760){alert("Le fichier ".concat(t.name," d\xe9passe la taille maximale de 10MB"));continue}let r=t.name.split(".").pop(),s="".concat(Math.random(),".").concat(r),a="".concat(e.user.id,"/").concat(x,"/").concat(s),{error:o}=await i.O.storage.from("photos").upload(a,t,{cacheControl:"3600",upsert:!1,contentType:t.type});if(o)throw console.error("Erreur d'upload:",o),Error("Erreur lors de l'upload de ".concat(t.name,": ").concat(o.message));let{data:{publicUrl:l}}=i.O.storage.from("photos").getPublicUrl(a),{error:n}=await i.O.from("photos").insert([{name:t.name,url:l,size:t.size,folder_id:x,user_id:e.user.id,uploaded_at:new Date().toISOString()}]);if(n)throw console.error("Erreur base de donn\xe9es:",n),Error("Erreur lors de l'enregistrement de ".concat(t.name,": ").concat(n.message))}v(e.user.id)}catch(e){console.error("Erreur lors de l'upload des photos:",e),p(e.message||"Erreur lors de l'upload des photos")}},[x]),E=async e=>{if(!x){alert("Veuillez s\xe9lectionner un dossier avant d'ajouter des photos");return}let r=Array.from(e.target.files||[]).filter(e=>e.type.startsWith("image/"));if(0===r.length){alert("Veuillez s\xe9lectionner uniquement des fichiers images");return}try{let{data:{session:e}}=await i.O.auth.getSession();if(!e)return;for(let t of r){if(t.size>10485760){alert("Le fichier ".concat(t.name," d\xe9passe la taille maximale de 10MB"));continue}let r=t.name.split(".").pop(),s="".concat(Math.random(),".").concat(r),a="".concat(e.user.id,"/").concat(x,"/").concat(s),{error:o}=await i.O.storage.from("photos").upload(a,t,{cacheControl:"3600",upsert:!1,contentType:t.type});if(o)throw console.error("Erreur d'upload:",o),Error("Erreur lors de l'upload de ".concat(t.name,": ").concat(o.message));let{data:{publicUrl:l}}=i.O.storage.from("photos").getPublicUrl(a),{error:n}=await i.O.from("photos").insert([{name:t.name,url:l,size:t.size,folder_id:x,user_id:e.user.id,uploaded_at:new Date().toISOString()}]);if(n)throw console.error("Erreur base de donn\xe9es:",n),Error("Erreur lors de l'enregistrement de ".concat(t.name,": ").concat(n.message))}v(e.user.id)}catch(e){console.error("Erreur lors de l'upload des photos:",e),p(e.message||"Erreur lors de l'upload des photos")}},D=async(e,r)=>{if(confirm("\xcates-vous s\xfbr de vouloir supprimer cette photo ?"))try{let{data:{session:t}}=await i.O.auth.getSession();if(!t)return;let s=r.split("/").slice(-3).join("/"),{error:a}=await i.O.storage.from("photos").remove([s]);if(a)throw console.error("Erreur lors de la suppression du fichier:",a),Error("Erreur lors de la suppression du fichier");let{error:o}=await i.O.from("photos").delete().eq("id",e);if(o)throw console.error("Erreur lors de la suppression de la photo:",o),Error("Erreur lors de la suppression de la photo");v(t.user.id)}catch(e){console.error("Erreur lors de la suppression:",e),p(e.message||"Erreur lors de la suppression de la photo")}};return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,s.jsx)(n,{}),(0,s.jsxs)("div",{className:"flex pt-4",children:[(0,s.jsx)("div",{className:"w-64 bg-white shadow-lg min-h-[calc(100vh-64px)] sticky top-16",children:(0,s.jsxs)("div",{className:"p-4",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold",children:"Mes Dossiers"}),(0,s.jsx)("button",{onClick:w,className:"bg-blue-500 text-white p-2 rounded-lg hover:bg-blue-600 transition-colors",title:"Nouveau dossier",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M10 3a1 1 0 011 1v5h5a1 1 0 110 2h-5v5a1 1 0 11-2 0v-5H4a1 1 0 110-2h5V4a1 1 0 011-1z",clipRule:"evenodd"})})})]}),(0,s.jsx)("div",{className:"space-y-2 max-h-[calc(100vh-200px)] overflow-y-auto",children:l.map(e=>(0,s.jsxs)("div",{className:"p-3 rounded-lg cursor-pointer transition-colors group ".concat(x===e.id?"bg-blue-100 text-blue-700":"hover:bg-gray-100"),onClick:()=>g(e.id),children:[(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 ".concat(x===e.id?"text-blue-700":"text-gray-400"),viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M2 6a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1H2V6zm0 3v6a2 2 0 002 2h12a2 2 0 002-2V9H2z",clipRule:"evenodd"})}),(0,s.jsx)("span",{className:"font-medium truncate",children:e.name})]}),(0,s.jsx)("span",{className:"text-sm text-gray-500 bg-gray-100 px-2 py-1 rounded-full",children:e.photoCount})]}),(0,s.jsxs)("p",{className:"text-xs text-gray-500 mt-1",children:["Modifi\xe9 le ",e.lastModified]})]},e.id))})]})}),(0,s.jsx)("div",{className:"flex-1 px-8",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold",children:"Tableau de bord"}),x&&(0,s.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5 text-gray-400",viewBox:"0 0 20 20",fill:"currentColor",children:(0,s.jsx)("path",{fillRule:"evenodd",d:"M2 6a2 2 0 012-2h4l2 2h4a2 2 0 012 2v1H2V6zm0 3v6a2 2 0 002 2h12a2 2 0 002-2V9H2z",clipRule:"evenodd"})}),(0,s.jsx)("span",{className:"text-gray-600",children:null===(e=l.find(e=>e.id===x))||void 0===e?void 0:e.name})]})]}),m&&(0,s.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4",children:m}),u?(0,s.jsx)("div",{className:"text-center py-8",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"})}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"border-2 border-dashed rounded-lg p-8 text-center mb-8 transition-colors ".concat(f?"border-blue-500 bg-blue-50":"border-gray-300 hover:border-blue-500"),onDragEnter:j,onDragLeave:y,onDragOver:N,onDrop:k,children:[(0,s.jsx)("input",{type:"file",accept:"image/*",multiple:!0,className:"hidden",onChange:E,id:"file-upload"}),(0,s.jsxs)("label",{htmlFor:"file-upload",className:"cursor-pointer text-blue-500 hover:text-blue-600",children:[(0,s.jsx)("div",{className:"text-4xl mb-2",children:"\uD83D\uDCF8"}),(0,s.jsx)("p",{className:"text-lg mb-2",children:"Glissez-d\xe9posez vos photos ici ou cliquez pour s\xe9lectionner"}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Formats accept\xe9s : JPG, PNG, GIF (max 10MB)"})]})]}),(0,s.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:x?null===(r=l.find(e=>e.id===x))||void 0===r?void 0:r.photos.sort((e,r)=>new Date(r.uploaded_at).getTime()-new Date(e.uploaded_at).getTime()).map(e=>(0,s.jsx)(d,{url:e.url,name:e.name,uploaded_at:e.uploaded_at,onDelete:()=>D(e.id,e.url)},e.id)):(0,s.jsxs)("div",{className:"col-span-full text-center py-12",children:[(0,s.jsx)("div",{className:"text-4xl mb-4",children:"\uD83D\uDCC1"}),(0,s.jsx)("p",{className:"text-lg text-gray-600",children:"S\xe9lectionnez un dossier pour voir ses photos"})]})})]})]})})]})]})}},7662:function(e,r,t){"use strict";t.d(r,{O:function(){return o}});var s=t(1051);let a={supabase:{url:"https://igeaimikswzxnaduekrr.supabase.co",anonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlnZWFpbWlrc3d6eG5hZHVla3JyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI4OTQ2OTMsImV4cCI6MjA1ODQ3MDY5M30.S3osZcB9x8ygSDDMOfTxvvUHoxAbL1zlQNY70uLVrJA"}},o=(0,s.eI)(a.supabase.url,a.supabase.anonKey)}},function(e){e.O(0,[250,834,971,69,744],function(){return e(e.s=8621)}),_N_E=e.O()}]);