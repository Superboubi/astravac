(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[352],{4161:function(e,s,t){Promise.resolve().then(t.bind(t,8647))},8647:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return n}});var a=t(3827),l=t(7907),i=t(4090),r=t(1048),d=t(7662);function n(){let e=(0,l.useRouter)(),[s,t]=(0,i.useState)({totalSpace:1e3,usedSpace:0,totalUsers:0,totalFolders:0,totalPhotos:0,spaceByUser:[]}),[n,c]=(0,i.useState)(!0),[o,x]=(0,i.useState)(null);(0,i.useEffect)(()=>{(async()=>{let{data:{session:s}}=await d.O.auth.getSession();if(!s){e.push("/auth/login");return}let{data:t,error:a}=await d.O.from("users").select("role").eq("id",s.user.id).single();if(a||(null==t?void 0:t.role)!=="admin"){e.push("/dashboard");return}m()})()},[e]);let m=async()=>{try{c(!0),x(null);let{data:e,error:s}=await d.O.from("users").select("*");if(s)throw s;let{data:a,error:l}=await d.O.from("photos").select("*");if(l)throw l;let i=e.map(e=>{let s=a.filter(s=>s.user_id===e.id),t=s.reduce((e,s)=>e+(s.size||0),0)/1073741824;return{userId:e.id,userName:e.name,usedSpace:t,photoCount:s.length}}),r=i.reduce((e,s)=>e+s.usedSpace,0),n=a.length;t({totalSpace:1e3,usedSpace:r,totalUsers:e.length,totalFolders:e.reduce((e,s)=>{var t;return e+(null===(t=s.folders)||void 0===t?void 0:t.length)||0},0),totalPhotos:n,spaceByUser:i})}catch(e){console.error("Erreur lors du chargement des statistiques:",e),x("Erreur lors du chargement des statistiques")}finally{c(!1)}},u=e=>e>=1e3?"".concat((e/1e3).toFixed(1)," TB"):"".concat(e.toFixed(1)," GB"),h=(e,s)=>(e/s*100).toFixed(1);return n?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(r.N,{}),(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[calc(100vh-64px)]",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})})]}):o?(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(r.N,{}),(0,a.jsx)("div",{className:"flex items-center justify-center min-h-[calc(100vh-64px)]",children:(0,a.jsx)("div",{className:"text-red-500",children:o})})]}):(0,a.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,a.jsx)(r.N,{}),(0,a.jsxs)("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:[(0,a.jsx)("div",{className:"py-6",children:(0,a.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Gestion du stockage"})}),(0,a.jsxs)("div",{className:"grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-4",children:[(0,a.jsxs)("div",{className:"overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6",children:[(0,a.jsx)("dt",{className:"truncate text-sm font-medium text-gray-500",children:"Espace total"}),(0,a.jsx)("dd",{className:"mt-1 text-3xl font-semibold tracking-tight text-gray-900",children:u(s.totalSpace)})]}),(0,a.jsxs)("div",{className:"overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6",children:[(0,a.jsx)("dt",{className:"truncate text-sm font-medium text-gray-500",children:"Espace utilis\xe9"}),(0,a.jsx)("dd",{className:"mt-1 text-3xl font-semibold tracking-tight text-gray-900",children:u(s.usedSpace)})]}),(0,a.jsxs)("div",{className:"overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6",children:[(0,a.jsx)("dt",{className:"truncate text-sm font-medium text-gray-500",children:"Utilisateurs"}),(0,a.jsx)("dd",{className:"mt-1 text-3xl font-semibold tracking-tight text-gray-900",children:s.totalUsers})]}),(0,a.jsxs)("div",{className:"overflow-hidden rounded-lg bg-white px-4 py-5 shadow sm:p-6",children:[(0,a.jsx)("dt",{className:"truncate text-sm font-medium text-gray-500",children:"Photos totales"}),(0,a.jsx)("dd",{className:"mt-1 text-3xl font-semibold tracking-tight text-gray-900",children:s.totalPhotos})]})]}),(0,a.jsx)("div",{className:"mt-8",children:(0,a.jsx)("div",{className:"overflow-hidden rounded-lg bg-white shadow",children:(0,a.jsxs)("div",{className:"px-4 py-5 sm:p-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium leading-6 text-gray-900",children:"Utilisation par utilisateur"}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)("div",{className:"relative pt-1",children:(0,a.jsx)("div",{className:"overflow-hidden h-2 mb-4 text-xs flex rounded bg-blue-200",children:(0,a.jsx)("div",{style:{width:"".concat(h(s.usedSpace,s.totalSpace),"%")},className:"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-blue-500"})})})}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)("ul",{className:"divide-y divide-gray-200",children:s.spaceByUser.map(e=>(0,a.jsxs)("li",{className:"py-5",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm font-medium text-gray-900",children:e.userName}),(0,a.jsxs)("p",{className:"text-sm text-gray-500",children:[e.photoCount," photos â€¢ ",u(e.usedSpace)]})]}),(0,a.jsxs)("div",{className:"text-sm text-gray-500",children:[h(e.usedSpace,s.totalSpace),"%"]})]}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)("div",{className:"relative pt-1",children:(0,a.jsx)("div",{className:"overflow-hidden h-2 mb-4 text-xs flex rounded bg-blue-200",children:(0,a.jsx)("div",{style:{width:"".concat(h(e.usedSpace,s.totalSpace),"%")},className:"shadow-none flex flex-col text-center whitespace-nowrap text-white justify-center bg-blue-500"})})})})]},e.userId))})})]})})})]})]})}},1048:function(e,s,t){"use strict";t.d(s,{N:function(){return r}});var a=t(3827),l=t(7907),i=t(8792);function r(){let e=(0,l.useRouter)();return(0,a.jsx)("nav",{className:"bg-white shadow",children:(0,a.jsx)("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:(0,a.jsxs)("div",{className:"flex h-16 justify-between",children:[(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("div",{className:"flex flex-shrink-0 items-center",children:(0,a.jsx)("span",{className:"text-xl font-bold text-blue-600",children:"Admin Panel"})}),(0,a.jsxs)("div",{className:"hidden sm:ml-6 sm:flex sm:space-x-8",children:[(0,a.jsx)(i.default,{href:"/admin/dashboard",className:"inline-flex items-center border-b-2 border-blue-500 px-1 pt-1 text-sm font-medium text-gray-900",children:"Tableau de bord"}),(0,a.jsx)(i.default,{href:"/admin/users",className:"inline-flex items-center border-b-2 border-transparent px-1 pt-1 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-gray-700",children:"Utilisateurs"})]})]}),(0,a.jsx)("div",{className:"flex items-center",children:(0,a.jsx)("button",{onClick:()=>{localStorage.removeItem("isAuthenticated"),localStorage.removeItem("userRole"),localStorage.removeItem("userName"),e.push("/auth/login")},className:"rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-600",children:"D\xe9connexion"})})]})})})}},7662:function(e,s,t){"use strict";t.d(s,{O:function(){return i}});var a=t(1051);let l={supabase:{url:"https://igeaimikswzxnaduekrr.supabase.co",anonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlnZWFpbWlrc3d6eG5hZHVla3JyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI4OTQ2OTMsImV4cCI6MjA1ODQ3MDY5M30.S3osZcB9x8ygSDDMOfTxvvUHoxAbL1zlQNY70uLVrJA"}},i=(0,a.eI)(l.supabase.url,l.supabase.anonKey)}},function(e){e.O(0,[250,834,971,69,744],function(){return e(e.s=4161)}),_N_E=e.O()}]);