(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[427],{8592:function(e,s,t){Promise.resolve().then(t.bind(t,3767))},3767:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return o}});var r=t(3827),l=t(7907),a=t(4090),i=t(1048),n=t(7662);function o(){let e=(0,l.useRouter)(),[s,t]=(0,a.useState)([]),[o,d]=(0,a.useState)(""),[c,m]=(0,a.useState)(null),[u,h]=(0,a.useState)(!0),[x,f]=(0,a.useState)(null);(0,a.useEffect)(()=>{(async()=>{let{data:{session:s}}=await n.O.auth.getSession();if(!s){e.push("/auth/login");return}let{data:t,error:r}=await n.O.from("users").select("role").eq("id",s.user.id).single();if(r||(null==t?void 0:t.role)!=="admin"){e.push("/dashboard");return}p()})()},[e]);let p=async()=>{try{h(!0),f(null);let{data:e,error:s}=await n.O.from("users").select("*").order("created_at",{ascending:!1});if(s)throw s;let{data:r,error:l}=await n.O.from("folders").select("*");if(l)throw l;let{data:a,error:i}=await n.O.from("photos").select("*");if(i)throw i;let o=e.map(e=>{let s=r.filter(s=>s.user_id===e.id),t=a.filter(s=>s.user_id===e.id);return{...e,folders:s.map(e=>({...e,photoCount:t.filter(s=>s.folder_id===e.id).length,lastModified:new Date(e.updated_at).toLocaleDateString(),photos:t.filter(s=>s.folder_id===e.id).map(e=>({...e,uploaded_at:new Date(e.uploaded_at).toLocaleDateString()}))}))}});t(o)}catch(e){console.error("Erreur lors du chargement des donn\xe9es:",e),f("Erreur lors du chargement des donn\xe9es")}finally{h(!1)}},g=s.filter(e=>e.name.toLowerCase().includes(o.toLowerCase())||e.email.toLowerCase().includes(o.toLowerCase())),v={totalUsers:s.length,totalFolders:s.reduce((e,s)=>e+s.folders.length,0),totalPhotos:s.reduce((e,s)=>e+s.folders.reduce((e,s)=>e+s.photoCount,0),0),recentUsers:s.filter(e=>{let s=new Date(e.created_at),t=new Date;return t.setDate(t.getDate()-30),s>=t}).length};return u?(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)(i.N,{}),(0,r.jsx)("div",{className:"flex items-center justify-center min-h-[calc(100vh-64px)]",children:(0,r.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})})]}):x?(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)(i.N,{}),(0,r.jsx)("div",{className:"flex items-center justify-center min-h-[calc(100vh-64px)]",children:(0,r.jsx)("div",{className:"text-red-500",children:x})})]}):(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,r.jsx)(i.N,{}),(0,r.jsxs)("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:[(0,r.jsx)("div",{className:"py-6",children:(0,r.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Tableau de bord administrateur"})}),(0,r.jsx)("div",{className:"mb-6",children:(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("input",{type:"text",placeholder:"Rechercher un utilisateur...",value:o,onChange:e=>d(e.target.value),className:"w-full rounded-lg border border-gray-300 px-4 py-2 pl-10 focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),(0,r.jsx)("svg",{className:"absolute left-3 top-2.5 h-5 w-5 text-gray-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-4",children:[(0,r.jsx)("div",{className:"cursor-pointer rounded-lg bg-white p-6 shadow transition-all hover:shadow-md",onClick:()=>e.push("/admin/users"),children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"rounded-full bg-blue-100 p-3",children:(0,r.jsx)("svg",{className:"h-6 w-6 text-blue-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})}),(0,r.jsxs)("div",{className:"ml-4",children:[(0,r.jsx)("h2",{className:"text-sm font-medium text-gray-600",children:"Utilisateurs totaux"}),(0,r.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:v.totalUsers})]})]})}),(0,r.jsx)("div",{className:"cursor-pointer rounded-lg bg-white p-6 shadow transition-all hover:shadow-md",onClick:()=>e.push("/admin/users"),children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"rounded-full bg-green-100 p-3",children:(0,r.jsx)("svg",{className:"h-6 w-6 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})})}),(0,r.jsxs)("div",{className:"ml-4",children:[(0,r.jsx)("h2",{className:"text-sm font-medium text-gray-600",children:"Dossiers totaux"}),(0,r.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:v.totalFolders})]})]})}),(0,r.jsx)("div",{className:"cursor-pointer rounded-lg bg-white p-6 shadow transition-all hover:shadow-md",onClick:()=>e.push("/admin/users"),children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"rounded-full bg-yellow-100 p-3",children:(0,r.jsx)("svg",{className:"h-6 w-6 text-yellow-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),(0,r.jsxs)("div",{className:"ml-4",children:[(0,r.jsx)("h2",{className:"text-sm font-medium text-gray-600",children:"Photos totales"}),(0,r.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:v.totalPhotos})]})]})}),(0,r.jsx)("div",{className:"cursor-pointer rounded-lg bg-white p-6 shadow transition-all hover:shadow-md",onClick:()=>e.push("/admin/users"),children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"rounded-full bg-purple-100 p-3",children:(0,r.jsx)("svg",{className:"h-6 w-6 text-purple-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}),(0,r.jsxs)("div",{className:"ml-4",children:[(0,r.jsx)("h2",{className:"text-sm font-medium text-gray-600",children:"Nouveaux utilisateurs (30j)"}),(0,r.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:v.recentUsers})]})]})})]}),(0,r.jsxs)("div",{className:"mt-8",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)("h2",{className:"text-lg font-medium text-gray-900",children:"Utilisateurs r\xe9cents"}),(0,r.jsx)("button",{onClick:()=>e.push("/admin/users"),className:"text-sm font-medium text-blue-600 hover:text-blue-500",children:"Voir tout"})]}),(0,r.jsx)("div",{className:"mt-4 grid grid-cols-1 gap-6 sm:grid-cols-2 lg:grid-cols-3",children:g.slice(0,6).map(s=>(0,r.jsx)("div",{className:"cursor-pointer rounded-lg bg-white p-6 shadow transition-all hover:shadow-md",onClick:()=>e.push("/admin/users/".concat(s.id)),children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("div",{className:"flex-shrink-0",children:(0,r.jsx)("div",{className:"h-12 w-12 rounded-full bg-gray-200 flex items-center justify-center",children:(0,r.jsx)("span",{className:"text-xl font-medium text-gray-600",children:s.name.charAt(0)})})}),(0,r.jsxs)("div",{className:"ml-4",children:[(0,r.jsx)("h3",{className:"text-sm font-medium text-gray-900",children:s.name}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:s.email}),(0,r.jsxs)("div",{className:"mt-2 flex items-center text-sm text-gray-500",children:[(0,r.jsx)("svg",{className:"mr-1.5 h-5 w-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),s.folders.length," dossiers"]})]})]})},s.id))})]})]})]})}},1048:function(e,s,t){"use strict";t.d(s,{N:function(){return i}});var r=t(3827),l=t(7907),a=t(8792);function i(){let e=(0,l.useRouter)();return(0,r.jsx)("nav",{className:"bg-white shadow",children:(0,r.jsx)("div",{className:"mx-auto max-w-7xl px-4 sm:px-6 lg:px-8",children:(0,r.jsxs)("div",{className:"flex h-16 justify-between",children:[(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("div",{className:"flex flex-shrink-0 items-center",children:(0,r.jsx)("span",{className:"text-xl font-bold text-blue-600",children:"Admin Panel"})}),(0,r.jsxs)("div",{className:"hidden sm:ml-6 sm:flex sm:space-x-8",children:[(0,r.jsx)(a.default,{href:"/admin/dashboard",className:"inline-flex items-center border-b-2 border-blue-500 px-1 pt-1 text-sm font-medium text-gray-900",children:"Tableau de bord"}),(0,r.jsx)(a.default,{href:"/admin/users",className:"inline-flex items-center border-b-2 border-transparent px-1 pt-1 text-sm font-medium text-gray-500 hover:border-gray-300 hover:text-gray-700",children:"Utilisateurs"})]})]}),(0,r.jsx)("div",{className:"flex items-center",children:(0,r.jsx)("button",{onClick:()=>{localStorage.removeItem("isAuthenticated"),localStorage.removeItem("userRole"),localStorage.removeItem("userName"),e.push("/auth/login")},className:"rounded-md bg-red-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-red-500 focus-visible:outline focus-visible:outline-2 focus-visible:outline-offset-2 focus-visible:outline-red-600",children:"D\xe9connexion"})})]})})})}},7662:function(e,s,t){"use strict";t.d(s,{O:function(){return a}});var r=t(1051);let l={supabase:{url:"https://igeaimikswzxnaduekrr.supabase.co",anonKey:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlnZWFpbWlrc3d6eG5hZHVla3JyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDI4OTQ2OTMsImV4cCI6MjA1ODQ3MDY5M30.S3osZcB9x8ygSDDMOfTxvvUHoxAbL1zlQNY70uLVrJA"}},a=(0,r.eI)(l.supabase.url,l.supabase.anonKey)}},function(e){e.O(0,[250,834,971,69,744],function(){return e(e.s=8592)}),_N_E=e.O()}]);